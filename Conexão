from pyspark.sql import SparkSession
import os

def iniciar_spark():
    # Caminho absoluto para o driver JDBC PostgreSQL
    caminho_jar = "C:/Users/Shirley/Downloads/postgresql-42.7.4.jar"

    print("ğŸ” Verificando se o driver JDBC existe no caminho informado...")
    if not os.path.isfile(caminho_jar):
        print(f"âŒ Driver JDBC nÃ£o encontrado em: {caminho_jar}")
        return None
    else:
        print(f"âœ… Driver JDBC localizado em: {caminho_jar}")

    try:
        print("ğŸš€ Iniciando SparkSession com o driver PostgreSQL...")
        spark = SparkSession.builder \
            .appName("StarComex_ETL") \
            .config("spark.jars", caminho_jar) \
            .config("spark.driver.extraClassPath", caminho_jar) \
            .getOrCreate()

        print("âœ… SparkSession criada com sucesso!")
        return spark

    except Exception as e:
        print(f"âŒ Erro ao iniciar SparkSession: {e}")
        return None

# Testa a funÃ§Ã£o se o arquivo for executado diretamente
if __name__ == "__main__":
    spark_teste = iniciar_spark()
    if spark_teste:
        print("ğŸ‰ Teste concluÃ­do: SparkSession estÃ¡ pronta para uso.")
    else:
        print("âš ï¸ Teste falhou: NÃ£o foi possÃ­vel iniciar a SparkSession.")
