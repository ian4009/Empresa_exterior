from pyspark.sql import SparkSession

# Caminho para o driver JDBC
jdbc_driver_path = "lib/postgresql-42.7.4.jar"

# Cria a sessão Spark com o driver JDBC
spark = SparkSession.builder \
    .appName("ConexaoPostgres") \
    .config("spark.jars", jdbc_driver_path) \
    .getOrCreate()

# Configurações do banco de dados
db_url = "jdbc:postgresql://localhost:5432/empresa_exterior"
db_properties = {
    "user": "postgres",
    "password": "12345",
    "driver": "org.postgresql.Driver"
}

# Nome da tabela que deseja ler
tabela = "transacoes"

# Lê os dados da tabela usando JDBC
df = spark.read.jdbc(url=db_url, table=tabela, properties=db_properties)

# Mostra os dados
df.show()

# Opcional: imprime o esquema (colunas e tipos)
df.printSchema()

# Finaliza a sessão
spark.stop()
